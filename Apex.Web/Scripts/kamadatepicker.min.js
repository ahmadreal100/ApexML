var kamaDatepicker = function (t, e) { var n, a, d, o, r, s, l, c, p, g = e || {}, u = !1, v = !1, f = ["٠", "١", "٢", "٣", "۴", "۵", "۶", "٧", "٨", "٩", "١٠", "١١", "١٢", "١٣", "١۴", "١۵", "١۶", "١٧", "١٨", "١٩", "٢٠", "٢١", "٢٢", "٢٣", "٢۴", "٢۵", "٢۶", "٢٧", "٢٨", "٢٩", "٣٠", "٣١", "٣٢"]; g.placeholder = void 0 !== g.placeholder ? g.placeholder : "", g.twodigit = void 0 === g.twodigit || g.twodigit, g.closeAfterSelect = void 0 === g.closeAfterSelect || g.closeAfterSelect, g.nextButtonIcon = void 0 !== g.nextButtonIcon && g.nextButtonIcon, g.previousButtonIcon = void 0 !== g.previousButtonIcon && g.previousButtonIcon, g.buttonsColor = void 0 !== g.buttonsColor && g.buttonsColor, g.forceFarsiDigits = void 0 !== g.forceFarsiDigits && g.forceFarsiDigits, g.markToday = void 0 !== g.markToday && g.markToday, g.markHolidays = void 0 !== g.markHolidays && g.markHolidays, g.highlightSelectedDay = void 0 !== g.highlightSelectedDay && g.highlightSelectedDay, g.sync = void 0 !== g.sync && g.sync, g.gotoToday = void 0 !== g.gotoToday && g.gotoToday, g.hasTime = void 0 === g.hasTime || g.hasTime; var b = "object" == typeof t ? t : $(t), h = new Date, y = `kdp${h.getMonth()}${h.getDay()}${h.getHours()}${h.getMinutes()}${h.getSeconds()}${h.getMilliseconds()}`; t = y, void 0 === b.attr("placeholder") && b.attr("placeholder", g.placeholder), b.wrap(`<div id='bd-root-${t}' style='position: relative;'></div>`), b.after(`<div id='bd-main-${t}' class='bd-main bd-hide' style='position: absolute; direction: rtl;'></div>`); var m = $(`#bd-main-${t}`); m.append("<div class='bd-calendar'></div>"); var I = m.find(".bd-calendar"); m.append("<div class='bd-time' hidden></div>"); var k = m.find(".bd-time"); k.append("<div><p>دقیقه</p><input class='bd-time-minute form-control' arval='digit|nodot|nocomma' arvalmin='0' arvalmax='59'/></div>"), k.append("<span> : </span>"), k.append("<div><p>ساعت</p><input class='bd-time-hour form-control' arval='digit|nodot|nocomma' arvalmin='0' arvalmax='23'/></div>"), k.append("<hr class='pcs-dashed'>"), k.append("<a class='bd-time-clear btn btn-danger btn-sm'>پاک کردن</div>"), k.append("<a class='bd-time-confirm btn btn-success btn-sm'>تایید</div>"); var w = k.find(".bd-time-clear"), x = k.find(".bd-time-confirm"); I.append("<div class='bd-title'></div>"); var D = I.find(".bd-title"); I.append("<table class='bd-table' dir='rtl' cellspacing='0' cellpadding='0'></table>"), D.append(`<button id='bd-next-${t}' class='bd-next' type='button' title='ماه بعد' data-toggle='tooltip'><span>بعد</span></button>`); var C = $(`#bd-next-${t}`); g.nextButtonIcon && (C.find("span").css("display", "none"), -1 !== g.nextButtonIcon.indexOf(".") ? C.css("background-image", `url(${g.nextButtonIcon})`) : C.addClass(g.nextButtonIcon)), D.append("<div class='bd-dropdown'></div><div class='bd-dropdown'></div>"), D.find(".bd-dropdown:nth-child(2)").append(`<select id='bd-month-${t}' class='bd-month'></select>`); var T = $(`#bd-month-${t}`); $.each({ 1: "فروردین", 2: "اردیبهشت", 3: "خرداد", 4: "تیر", 5: "مرداد", 6: "شهریور", 7: "مهر", 8: "آبان", 9: "آذر", 10: "دی", 11: "بهمن", 12: "اسفند" }, function (t, e) { T.append($("<option></option>").attr("value", t).text(e)) }), D.find(".bd-dropdown:nth-child(3)").append(`<select id='bd-year-${t}' class='bd-year'></select>`); var B = $(`#bd-year-${t}`); D.append(`<button id='bd-prev-${t}' class='bd-prev' type='button' title='ماه قبل' data-toggle='tooltip'><span>قبل</span></button>`); var S = $(`#bd-prev-${t}`); g.nextButtonIcon && (S.find("span").css("display", "none"), -1 !== g.previousButtonIcon.indexOf(".") ? S.css("background-image", `url(${g.previousButtonIcon})`) : S.addClass(g.previousButtonIcon)), g.buttonsColor && (C.css("color", g.buttonsColor), C.find("span").css("color", g.buttonsColor), S.css("color", g.buttonsColor), S.find("span").css("color", g.buttonsColor)), I.find(".bd-table").append("<thead><tr></tr></thead>"), $.each({ "شنبه": "ش", "یکشنبه": "ی", "دوشنبه": "د", "سه شنبه": "س", "چهارشنبه": "چ", "پنج شنبه": "پ", "جمعه": "ج" }, function (t, e) { I.find(".bd-table thead tr").append($("<th></th>").text(e)) }), I.find(".bd-table").append(`<tbody id='bd-table-days-${t}' class='bd-table-days'></tbody>`); var F, j, Z = $(`#bd-table-days-${t}`); g.gotoToday && (I.append("<div class='bd-goto-today'>برو به امروز</div>"), F = I.find(".bd-goto-today")), g.hasTime && (I.append("<a class='bd-switch-ct btn btn-default btn-sm'><i class='fa fa-clock-o'></i></div>"), k.append("<a class='bd-switch-ct btn btn-default btn-sm'><i class='fa fa-calendar'></i></div>"), j = m.find(".bd-switch-ct")), b.on("focus", function () { void 0 === $(this).attr("readonly") && (u || (I.show(), k.hide(), m.removeClass("bd-hide"), g.sync && !1 === v && (q(), v = !0))) }).on("blur", function () { u ? u = !1 : (m.addClass("bd-hide"), v = !1) }), m.on("mousedown", function (t) { u = !0 }), T.on("change", function () { a = parseInt(this.value), l = G(n, a), s = L(n, a), N(l, s) }), B.on("change", function () { n = parseInt(this.value), l = G(n, a), s = L(n, a), N(l, s) }); var A = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], H = [31, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 29]; function M(t, e, n) { return function (t) { var e, n, a; const i = Y(t).gy; var d = i - 621; const o = E(d), r = U(i, 3, o.march); if ((a = t - r) >= 0) { if (185 >= a) return n = 1 + J(a, 31), e = R(a, 31) + 1, { jy: d, jm: n, jd: e }; a -= 186 } else d -= 1, a += 179, 1 === o.leap && (a += 1); return n = 7 + J(a, 30), e = R(a, 30) + 1, { jy: d, jm: n, jd: e } }(U(t, e, n)) } function O(t, e, n) { return Y(function (t, e, n) { const a = E(t); return U(a.gy, 3, a.march) + 31 * (e - 1) - J(e, 7) * (e - 7) + n - 1 }(t, e, n)) } function E(t) { var e, n, a, i, d, o; const r = [-61, 9, 38, 199, 426, 686, 756, 818, 1111, 1181, 1210, 1635, 2060, 2097, 2192, 2262, 2324, 2394, 2456, 3178], s = r.length, l = t + 621; var c = -14, p = r[0]; if (p > t || t >= r[s - 1]) throw new Error(`Invalid Jalaali year ${t}`); for (o = 1; s > o && (n = (e = r[o]) - p, !(e > t)); o += 1)c = c + 8 * J(n, 33) + J(R(n, 33), 4), p = e; return c = c + 8 * J(d = t - p, 33) + J(R(d, 33) + 3, 4), 4 === R(n, 33) && n - d == 4 && (c += 1), i = 20 + c - (J(l, 4) - J(3 * (J(l, 100) + 1), 4) - 150), 6 > n - d && (d = d - n + 33 * J(n + 4, 33)), -1 === (a = R(R(d + 1, 33) - 1, 4)) && (a = 4), { leap: a, gy: l, march: i } } function U(t, e, n) { var a = J(1461 * (t + J(e - 8, 6) + 100100), 4) + J(153 * R(e + 9, 12) + 2, 5) + n - 34840408; return a - J(3 * J(t + 100100 + J(e - 8, 6), 100), 4) + 752 } function Y(t) { var e, n, a, i; return a = J(R(n = 5 * J(R(e = (e = 4 * t + 139361631) + 4 * J(3 * J(4 * t + 183187720, 146097), 4) - 3908, 1461), 4) + 308, 153), 5) + 1, i = R(J(n, 153), 12) + 1, { gy: J(e, 1461) - 100100 + J(8 - i, 6), gm: i, gd: a } } function J(t, e) { return ~~(t / e) } function R(t, e) { return t - ~~(t / e) * e } var q = function () { var t = z(b.val()); if ("" === t) { const e = new Date, n = M(e.getFullYear(), e.getMonth() + 1, e.getDate()); t = n.jy + "/" + n.jm + "/" + n.jd } const e = t; t = t.split("/"), T.val(parseInt(t[1])), T.trigger("change"), B.val(parseInt(t[0])), B.trigger("change"); const n = e.match(/(\d{1,2}:\d{1,2})/); k.find("input.bd-time-hour").val(null === n ? "mvcgrid-datepicker-2" === b.attr("id") ? "23" : "0" : n[0].split(":")[0]), k.find("input.bd-time-minute").val(null === n ? "mvcgrid-datepicker-2" === b.attr("id") ? "59" : "0" : n[0].split(":")[1]), g.highlightSelectedDay && (m.find(".bd-selected-day").removeClass("bd-selected-day"), m.find(`.day-${parseInt(t[2])}`).addClass("bd-selected-day")) }, z = function (t) { return "" === t ? "" : ((t = t.split("/"))[1].length < 2 && t[1] < 10 && (t[1] = `0${t[1]}`), t[2].length < 2 && t[2] < 10 && (t[2] = `0${t[2]}`), t = t.join("/")) }, G = function (t, e) { return e < 7 ? 31 : e < 12 ? 30 : function (t) { var e; return t < 1343 && t > 1243 ? 1 == (e = t % 33) || 5 == e || 9 == e || 13 == e || 17 == e || 22 == e || 26 == e || 30 == e : t < 1473 && t > 1342 ? 1 == (e = t % 17) || 5 == e || 9 == e || 13 == e || 18 == e || 22 == e || 26 == e || 30 == e : "unknown" }(t) ? 30 : 29 }; p = function (t, e, n) { for (var a = (t = parseInt(t)) - 1600, i = (e = parseInt(e)) - 1, d = (n = parseInt(n)) - 1, o = 365 * a + parseInt((a + 3) / 4) - parseInt((a + 99) / 100) + parseInt((a + 399) / 400), r = 0; i > r; ++r)o += A[r]; i > 1 && (a % 4 == 0 && a % 100 != 0 || a % 400 == 0) && ++o; var s = (o += d) - 79; const l = parseInt(s / 12053); s %= 12053; var c = 979 + 33 * l + 4 * parseInt(s / 1461); for ((s %= 1461) >= 366 && (c += parseInt((s - 1) / 365), s = (s - 1) % 365), r = 0; 11 > r && s >= H[r]; ++r)s -= H[r]; return [c, r + 1, s + 1] }((c = new Date).getFullYear(), c.getMonth() + 1, c.getDate()); var K = []; for (i = 0; i < 3; i++)K[i] = p[i]; d = p[0], o = p[1], r = p[2], n = K[0], a = K[1], K[2], T.val(a), function (t) { for (B.find("option").remove(), i = 0; i < 101; i++) { let e = t - 95 + i + ""; if (g.forceFarsiDigits) for (let t = 0; t < 10; t++) { const n = new RegExp(t, "g"); e = e.replace(n, f[t]) } B.append($("<option>", { value: t - 95 + i, text: e })) } }(n), B.val(n), l = G(n, a); var L = function (t, e) { var n, a = O(t, e, 1); return a = new Date(a.gy + "/" + a.gm + "/" + a.gd), (n = a.getDay()) < 6 ? n + 1 : 0 }; s = L(n, a); var N = function (e, s) { Z.empty(); for (var l = 1, c = 1; l <= e;) { for (Z.append($("<tr>", { class: `tr-${c}` })), i = 0; i < 7; i++) { if (1 == l) { let e = 0; for (; e < s;)$(`#bd-table-days-${t} .tr-1`).append($("<td>", { class: "bd-empty-cell" })), e++ , i++ } if (i < 7 && l <= e) { let e = `<td><button class="day day-${l}" type="button">${g.forceFarsiDigits ? f[l] : l}</button></td>`; if (g.markToday && l == r && o == a && d == n) { var p = e.indexOf("day day-"); e = e.slice(0, p) + " bd-today " + e.slice(p) } if (g.markHolidays && 6 == i) { p = e.indexOf("day day-"); e = e.slice(0, p) + " bd-holiday " + e.slice(p) } $(`#bd-table-days-${t} .tr-${c}`).append(e), l++ } } c++ } if (g.highlightSelectedDay) { let t = b.val(); (t = t.split("/"))[0] == n && t[1] == a && (m.find(".bd-selected-day").removeClass("bd-selected-day"), m.find(`.day-${parseInt(t[2])}`).addClass("bd-selected-day")) } }; b.parent().on("click", "button.day", function () { var t = n + "/" + a + "/" + $(this).attr("class").split(" ")[$(this).attr("class").split(" ").indexOf("day") + 1].split("-")[1]; g.twodigit && (t = z(t)); var e = b.val(); e = null === e.match(/(\d{4}\/\d{1,2}\/\d{1,2})/) ? t : e.replace(/(\d{4}\/\d{1,2}\/\d{1,2})/, t); const i = b.attr("setFromTime"), s = b.attr("setToTime"); if (!/ \d{2}:\d{2}$/g.test(e)) if (void 0 !== i) { e = `${e} ${/^\d{2}:\d{2}$/g.test(i) ? i : "00:00"}` } else if (void 0 !== s) { e = `${e} ${/^\d{2}:\d{2}$/g.test(i) ? i : "23:59"}` } /nan/gi.test(e) && (/^nan\//gi.test(e) && (e = e.replace(/^nan\//gi, `${d}/`)), /\/nan\//gi.test(e) && (e = e.replace(/\/nan\//gi, `/${o.leadingZero()}/`)), /\/nan(?!\/)/gi.test(e) && (e = e.replace(/\/nan(?!\/)/gi, `/${r.leadingZero()}`))), b.val(e), b.trigger("change"), g.closeAfterSelect && (u = !1, b.trigger("blur")), g.highlightSelectedDay && (m.find(".bd-selected-day").removeClass("bd-selected-day"), $(this).addClass("bd-selected-day")) }), C.on("click", function () { T.val() < 12 ? (T.val(parseInt(T.val()) + 1), T.trigger("change")) : (T.val(1), T.trigger("change"), B.val(parseInt(B.val()) + 1), B.trigger("change")) }), S.on("click", function () { T.val() > 1 ? (T.val(parseInt(T.val()) - 1), T.trigger("change")) : (T.val(12), T.trigger("change"), B.val(parseInt(B.val()) - 1), B.trigger("change")) }), g.gotoToday && F.on("click", function () { T.val(o), T.trigger("change"), B.val(d), B.trigger("change") }), g.hasTime && (j.on("click", function () { I.is(":visible") ? (k.css({ width: m.width() + "px", height: m.height() + "px" }), I.slideUp(200), k.slideDown(200)) : (I.slideDown(200), k.slideUp(200)) }), w.on("click", function () { k.find("input").val(""); const t = b.val().match(/(\d{4}\/\d{1,2}\/\d{1,2})/); b.val(null === t ? "" : t[0]) }), x.on("click", function () { k.find("input").trigger("change"), u = !1, b.trigger("blur") }), k.find("input").on("keydown", function (t) { return "Tab" === t.key ? ($(this).parent().siblings("div").find("input").first().focus(), !1) : "Enter" !== t.key || (x.trigger("click"), !1) }), k.find("input").on("focus", function () { $(this).select() }), k.find("input").on("change keyup input paste", function () { for (; null === b.val().match(/(\d{4}\/\d{1,2}\/\d{1,2})/);) { const t = g.closeAfterSelect; g.closeAfterSelect = !1, m.find(".bd-selected-day").trigger("click"), g.closeAfterSelect = t } var t = b.val(); const e = t.match(/(\d{4}\/\d{1,2}\/\d{1,2})/); if ($(this).hasClass("bd-time-hour")) { const n = parseIntForce($(this).val(), 0); if (/:/.test(t)) t = t.replace(/ .*:/, ` ${n.leadingZero()}:`); else { const a = parseIntForce(k.find("input.bd-time-minute").val(), 0); t = e[0], t += ` ${n.leadingZero()}:${a.leadingZero()}` } } else { const n = parseIntForce($(this).val(), 0); if (/:/.test(t)) t = t.replace(/:.*/, `:${n.leadingZero()}`); else { const a = parseIntForce(k.find("input.bd-time-hour").val(), 0); t = e[0], t += ` ${a.leadingZero()}:${n.leadingZero()}` } } b.val(t) })), N(l, s), "function" == typeof $().modal && $('[data-toggle="tooltip"]').tooltip() };